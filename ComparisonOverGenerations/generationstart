# Install libraries (if not already installed)
!pip install transformers nltk scikit-learn torch pandas

# Import libraries
import nltk
import string
import pandas as pd
from nltk.corpus import wordnet
from transformers import BertTokenizer, BertModel
import torch
from sklearn.metrics.pairwise import cosine_similarity
import numpy as np

# Download NLTK data
nltk.download('wordnet')

# Generation-specific slang dictionaries
boomer_slang = {
    "groovy": "cool",
    "far out": "amazing",
    "square": "boring or traditional",
    "bummed out": "sad",
    "dig it": "understand or like"
}

genx_slang = {
    "phat": "excellent",
    "rad": "cool",
    "whatever": "dismissive attitude",
    "psyche": "just kidding",
    "poser": "fake person"
}

millennial_slang = {
    "adulting": "doing grown-up tasks",
    "basic": "mainstream or boring",
    "salty": "upset",
    "savage": "bold or ruthless",
    "throw shade": "insult indirectly"
}

genz_slang = {
    "no cap": "no lie",
    "bet": "okay or yes",
    "vibe check": "mood test",
    "rizz": "charisma",
    "slaps": "very good"
}

# Slang dictionaries grouped
generation_slang = {
    "Boomer": boomer_slang,
    "Gen X": genx_slang,
    "Millennial": millennial_slang,
    "Gen Z": genz_slang
}

# Initialize tokenizer
tokenizer = BertTokenizer.from_pretrained('bert-base-uncased')

# Function to analyze sentence
def detect_generation(sentence):
    # Lowercase and clean
    sentence_clean = sentence.lower()

    # Initialize scores
    generation_scores = {gen: 0 for gen in generation_slang.keys()}
    generation_matches = {gen: [] for gen in generation_slang.keys()}

    # Check full slang phrases
    for gen, slang_dict in generation_slang.items():
        for slang_term in slang_dict.keys():
            if slang_term in sentence_clean:
                generation_scores[gen] += 1
                generation_matches[gen].append(slang_term)

    # Determine best match
    if all(score == 0 for score in generation_scores.values()):
        best_gen = "No strong match"
    else:
        best_gen = max(generation_scores, key=generation_scores.get)

    # Build result
    result = {
        "sentence": sentence,
        "generation_scores": generation_scores,
        "generation_matches": generation_matches,
        "predicted_generation": best_gen
    }

    return result

# Example sentences to test
sentences = [
    "Yo that song slaps no cap.",
    "Man, that party was groovy.",
    "She is savage for throwing shade like that.",
    "Dude, that trick was rad!",
    "Adulting is so hard sometimes."
]

# Run detection
for sent in sentences:
    output = detect_generation(sent)
    print(f"\nSentence: {output['sentence']}")
    print(f"Predicted Generation: {output['predicted_generation']}")
    print("Matches:")
    for gen, matches in output['generation_matches'].items():
        if matches:
            print(f"  {gen}: {matches}")